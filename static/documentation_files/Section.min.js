/*!
 * LMV v7.70.0
 *
 * Copyright 2022 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Forge Viewer Usage Limitations:
 *
 * The Autodesk Forge Viewer JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */(()=>{var t={83427:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(87537),o=n.n(i),a=n(23645),s=n.n(a)()(o());s.push([t.id,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n","",{version:3,sources:["webpack://./extensions/Section/Section.css"],names:[],mappings:"AAGA,cACI,gBAAiB,CACjB,eAAgB,CAChB,UAAW,CACd,4BAIG,UAAW,CACX,0CAA2C,CAC9C,wBAIG,aAAc,CACd,iBAAkB,CAClB,uBAAwB,CACxB,0BAA2B,CAC3B,WAAY,CACf,6CAGE,WAAY,CACd,6BAIG,iBAAkB,CAClB,oBAAsB,CACtB,kBAAoB,CACpB,kBAAoB,CACvB,iBAGG,0BAA2B,CAC3B,yBAA0B,CAC1B,uBAAwB,CACxB,cAAe,CAClB,sCAGG,uCAAwC,CAC3C,sCAGG,sCAAwC,CACxC,gCAAiC,CACjC,6BAA8B,CAC9B,4BAA6B,CAC7B,2BAA4B,CAC5B,wBAAyB",sourcesContent:["/**\n * Section CSS\n **/\n.sectionPanel {\n    line-height: 14px;\n    text-align: left;\n    z-index: 10;\n}\n\n.section-horizontal-divider\n{\n    height: 1px;\n    border-top: 1px solid rgba(200,200,200,0.8);\n}\n\n.section-submenu-select\n{\n    display: block;\n    position: relative;\n    width: calc(100% - 40px);\n    padding: 10px 20px 0px 20px;\n    opacity: 0.3;\n}\n\n.section-panel:hover .section-submenu-select {\n   opacity: 0.8;\n}\n\n.section-submenu-selectlabel\n{\n    position: relative;\n    display:  inline-block;\n    padding-right:  20px;\n    padding-bottom:  4px;\n}\n\n.section-restart {\n    margin: 10px 20px 15px 20px;\n    padding: 6px 10px 6px 10px;\n    width: calc(100% - 55px);\n    cursor: pointer;\n}\n\n.docking-panel:hover .section-restart {\n    background-color: rgba(255,255,255, .12);\n}\n\n.docking-panel .section-restart:hover {\n    background-color: rgba(166,194,255, 0.7);\n    -webkit-transition: all 0.2s ease;\n    -moz-transition: all 0.2s ease;\n    -ms-transition: all 0.2s ease;\n    -o-transition: all 0.2s ease;\n    transition: all 0.2s ease;\n}\n\n"],sourceRoot:""}]);const r=s},23645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(i)for(var r=0;r<this.length;r++){var c=this[r][0];null!=c&&(s[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);i&&s[h[0]]||(void 0!==a&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},87537:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),a="/*# ".concat(o," */"),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([a]).join("\n")}return[e].join("\n")}},62705:(t,e,n)=>{var i=n(55639).Symbol;t.exports=i},44239:(t,e,n)=>{var i=n(62705),o=n(89607),a=n(2333),s=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?o(t):a(t)}},27561:(t,e,n)=>{var i=n(67990),o=/^\s+/;t.exports=function(t){return t?t.slice(0,i(t)+1).replace(o,""):t}},31957:(t,e,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=i},89607:(t,e,n)=>{var i=n(62705),o=Object.prototype,a=o.hasOwnProperty,s=o.toString,r=i?i.toStringTag:void 0;t.exports=function(t){var e=a.call(t,r),n=t[r];try{t[r]=void 0;var i=!0}catch(t){}var o=s.call(t);return i&&(e?t[r]=n:delete t[r]),o}},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},55639:(t,e,n)=>{var i=n(31957),o="object"==typeof self&&self&&self.Object===Object&&self,a=i||o||Function("return this")();t.exports=a},67990:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},23279:(t,e,n)=>{var i=n(13218),o=n(7771),a=n(14841),s=Math.max,r=Math.min;t.exports=function(t,e,n){var c,l,h,u,p,E,d=0,m=!1,f=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function w(e){var n=c,i=l;return c=l=void 0,d=e,u=t.apply(i,n)}function T(t){return d=t,p=setTimeout(g,e),m?w(t):u}function y(t){var n=t-E;return void 0===E||n>=e||n<0||f&&t-d>=h}function g(){var t=o();if(y(t))return R(t);p=setTimeout(g,function(t){var n=e-(t-E);return f?r(n,h-(t-d)):n}(t))}function R(t){return p=void 0,v&&c?w(t):(c=l=void 0,u)}function x(){var t=o(),n=y(t);if(c=arguments,l=this,E=t,n){if(void 0===p)return T(E);if(f)return clearTimeout(p),p=setTimeout(g,e),w(E)}return void 0===p&&(p=setTimeout(g,e)),u}return e=a(e)||0,i(n)&&(m=!!n.leading,h=(f="maxWait"in n)?s(a(n.maxWait)||0,e):h,v="trailing"in n?!!n.trailing:v),x.cancel=function(){void 0!==p&&clearTimeout(p),d=0,c=E=l=p=void 0},x.flush=function(){return void 0===p?u:R(o())},x}},13218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},37005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},33448:(t,e,n)=>{var i=n(44239),o=n(37005);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==i(t)}},7771:(t,e,n)=>{var i=n(55639);t.exports=function(){return i.Date.now()}},14841:(t,e,n)=>{var i=n(27561),o=n(13218),a=n(33448),s=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(a(t))return NaN;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=i(t);var n=r.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):s.test(t)?NaN:+t}},93379:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var a={},s=[],r=0;r<t.length;r++){var c=t[r],l=i.base?c[0]+i.base:c[0],h=a[l]||0,u="".concat(l," ").concat(h);a[l]=h+1;var p=n(u),E={css:c[1],media:c[2],sourceMap:c[3]};-1!==p?(e[p].references++,e[p].updater(E)):e.push({identifier:u,updater:o(E,i),references:1}),s.push(u)}return s}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var a=i(t=t||[],o=o||{});return function(t){t=t||[];for(var s=0;s<a.length;s++){var r=n(a[s]);e[r].references--}for(var c=i(t,o),l=0;l<a.length;l++){var h=n(a[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}a=c}}},90569:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},3565:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i=n.css,o=n.media,a=n.sourceMap;o?t.setAttribute("media",o):t.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{SectionExtension:()=>H});const t=(t,e,n)=>t.orthoPoint(e,n),e=n(23279);var o=null,a=Autodesk.Viewing.Private,s=function(n,i){var s,r,c,l=n.impl,h=["section"],u=!1,p=!1,E=!1,d=!0,m=i.tintColor,f=i.tintIntensity,v=isNaN(i.gizmoOffsetRight)?200:i.gizmoOffsetRight,w=isNaN(i.gizmoOffsetLeft)?80:i.gizmoOffsetLeft,T=isNaN(i.gizmoOffsetTop)?80:i.gizmoOffsetTop,y=isNaN(i.gizmoOffsetBottom)?80:i.gizmoOffsetBottom,g=new THREE.Vector3,R=new THREE.Vector3,x=new THREE.Vector3,H=[],b=[],M=[],P="",A="gizmo",S=null,C=!1,B=!0,V=[0,1,1,3,3,2,2,0],k=!0;const z=e(((t,e,n)=>{a.analytics.track("viewer.section",{from:t,type:e,action:n})}),2e3);function I(){l.invalidate(!1,!1,!0)}function O(){X(),s&&s.update(),r&&r.update()}function X(){if(!s||!s.object)return;const t=l.worldToClient(s.position),e=l.getCanvasBoundingClientRect();if(g.copy(t),t.x<w?g.x=w:t.x>e.width-v&&(g.x=e.width-v),t.y<T?g.y=T:t.y>e.height-y&&(g.y=e.height-y),g.x!==t.x||g.y!==t.y){const t=THREE.TransformControls.intersectObjects(g.x,g.y,[s.object],l.camera,!1);if(t){const e=H[0].position;R.copy(s.object.position).add(e),x.copy(t.point).sub(R),s.setGizmoOffset(x)}}}function G(){u&&1===b.length&&(N(!0),O(),j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)))}!function(){class t extends THREE.MeshBasicMaterial{constructor(t){super(),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}}}class e extends THREE.LineBasicMaterial{constructor(t){super(),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}}}var n=function(t,e,n){const i=[];n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return(new THREE.BufferGeometry).setFromPoints(i)},i=function(t,e,n,i,o,a){return new THREE.CylinderBufferGeometry(t,e,n,i,o,a).applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0))},o=function(t){const e=[];return"X"===t?e.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),(new THREE.BufferGeometry).setFromPoints(e)};class a extends THREE.Object3D{constructor(t){super();var e=this;this.init=function(){this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(t){if(t instanceof THREE.Mesh){t.updateMatrix();const e=t.geometry.clone();e.applyMatrix4(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}}))},this.hide=function(){this.traverse((function(t){t.visible=!1}))},this.show=function(){this.traverse((function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))}))},this.setupGizmos=function(){var e=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],a=t[n][i][1],s=t[n][i][2],r=t[n][i][3];o.name=n,a&&o.position.set(a[0],a[1],a[2]),s&&o.rotation.set(s[0],s[1],s[2]),r&&(o.visble=r),e.add(o)}};if(this.setHandlePickerGizmos(),t)for(var n=Object.keys(this.handleGizmos),i=0;i<n.length;i++){var o=n[i];-1===t.indexOf(o)&&(delete this.handleGizmos[o],delete this.pickerGizmos[o],delete this.hemiPickerGizmos[o])}e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}}update(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(a){a.name&&(-1!=a.name.search("E")?a.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==a.name.search("X")&&-1==a.name.search("Y")&&-1==a.name.search("Z")||a.quaternion.setFromEuler(t))}))}}THREE.TransformGizmo=a,THREE.TransformGizmoTranslate=class extends a{constructor(n){super(n),this.setHandlePickerGizmos=function(){var n=i(0,.05,.2,12,1,!1),a=o("X"),s=o("Y"),r=o("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(s,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()}},THREE.TransformGizmoRotate=class extends a{constructor(i){super(i),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(n(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(n(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(n(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(n(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(n(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(s,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(r,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))},this.init()}},THREE.TransformGizmoTranslateRotate=class extends a{constructor(e){super(e);var n=this;this.setHandlePickerGizmos=function(){var e=i(0,.05,.2,12,1,!1),n=.15;this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[n*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[n*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereBufferGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},this.setActivePlane=function(t,e,n){if("translate"==this.activeMode){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(s,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(r,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))}},this.show=function(){this.traverse((function(t){(null==n.parent||n.parent.useAllPickers||t.parent!=n.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=n.pickers&&t.parent!=n.hemiPicker&&t.parent!=n.subPickers||(t.visible=!1),t.parent!=n.planes&&t.parent!=n.highlights||(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?(e.parent!=n.highlights&&e.parent!=n.handles||(e.visible=!0),e.material.highlight(!0)):(e.material.highlight(!1),e.material.opacity=.1))}))},this.init()}},THREE.TransformGizmoScale=class extends a{constructor(n){super(n),this.setHandlePickerGizmos=function(){var n=i(.125,.125,.125),a=o("X"),s=o("Y"),r=o("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(s,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()}};const s=new THREE.Vector3,r=new THREE.Vector3,c=new THREE.Raycaster;class l extends THREE.Object3D{constructor(t,e,n,i){switch(super(),e=void 0!==e?e:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate(i);break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate(i);break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate(i);break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale(i)}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){var o,a=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],s=(new THREE.BufferGeometry).setFromPoints(a),r=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(s,r),a=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],s=(new THREE.BufferGeometry).setFromPoints(a),r=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1}),this.endLine=new THREE.Line(s,r),a=[new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)],s=(new THREE.BufferGeometry).setFromPoints(a),r=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1}),this.centerLine=new THREE.Line(s,r),(o=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=o.minFilter=THREE.NearestFilter,s=new THREE.CircleBufferGeometry(.1,32),r=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:o}),this.centerMark=new THREE.Mesh(s,r),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(o=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=o.minFilter=THREE.NearestFilter,r=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:o});var c=.25;this.ticks.RX=new THREE.Object3D,s=new THREE.PlaneBufferGeometry(.12,c);var l=new THREE.Mesh(s,r);l.position.set(0,0,-1.275),l.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(l),(l=l.clone()).position.set(0,-1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),this.ticks.RY=new THREE.Object3D,(l=l.clone()).position.set(0,0,-1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(-1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l)}var h=this,u=!1,p=n,E={type:"change"},d={type:"mouseDown"},m={type:"mouseUp",mode:p},f={type:"objectChange"},v=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Vector3,y=new THREE.Vector3,g=1;this.clientScale=1;var R=new THREE.Matrix4,x=new THREE.Vector3,H=new THREE.Matrix4,b=new THREE.Vector3,M=new THREE.Quaternion,P=new THREE.Vector3,A=new THREE.Vector3,S=new THREE.Vector3,C=new THREE.Quaternion,B=new THREE.Quaternion,V=new THREE.Quaternion,k=new THREE.Quaternion,z=new THREE.Quaternion,I=new THREE.Vector3,O=new THREE.Vector3,X=new THREE.Matrix4,G=new THREE.Matrix4,Y=new THREE.Vector3,j=new THREE.Vector3,Z=new THREE.Euler,_=new THREE.Matrix4,L=new THREE.Vector3;function D(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}new THREE.Euler,this.attach=function(t){h.object=t,this.gizmo[p].show(),h.update(),h.updateUnitVectors()},this.detach=function(t){h.object=void 0,this.axis=null,this.gizmo[p].hide()},this.setMode=function(t){"scale"==(p=t||p)&&(h.space="local"),this.gizmo[p].show(),this.update(),h.dispatchEvent(E)},this.getPicker=function(){return h.gizmo[p].hemiPicker.children},this.setPosition=function(t){this.object.position.copy(t),this.update()},this.setNormal=function(t){M.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(M),this.unitY.applyQuaternion(M),this.unitZ.applyQuaternion(M),this.normal.copy(t),this.object&&this.object.quaternion.multiply(M),this.update()},this.setRotation=function(t){this.object&&(this.object.quaternion.setFromRotationMatrix(t),this.update(),this.updateUnitVectors())},this.setSnap=function(t,e){h.snap=t,h.snapDelta=e},this.setSize=function(t){h.size=t,this.update(),h.dispatchEvent(E)},this.setSpace=function(t){h.space=t,this.update(),h.dispatchEvent(E)},this.update=function(n){if(void 0!==h.object){var i;if(h.object.updateMatrixWorld(),j.setFromMatrixPosition(h.object.matrixWorld),Z.setFromRotationMatrix(H.extractRotation(h.object.matrixWorld)),t.updateMatrixWorld(),L.setFromMatrixPosition(t.matrixWorld),this.position.copy(j),this.quaternion.setFromEuler(Z),this.normal.set(0,0,1),this.normal.applyEuler(Z),t.isPerspective){var o=j.distanceTo(L);i=2*Math.tan(t.fov*Math.PI/360)*o}else i=t.top-t.bottom;var a=e.getBoundingClientRect();g=100*this.clientScale*i/a.height,this.scale.set(g,g,g),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[p].highlight(h.axis)}},this.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(Z),this.unitY.applyEuler(Z),this.unitZ.applyEuler(Z)},this.showRotationGizmos=function(t){for(var e=this.gizmo[p].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},this.highlight=function(){this.gizmo[p].highlight(this.axis||"Z")},this.onPointerHover=function(t){if(void 0===h.object||!0===u)return!1;var e=D(t,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),h.axis!==n&&(h.axis=n,h.gizmo[p].activeMode=i,h.update(!0),h.dispatchEvent(E)),null===h.axis&&h.gizmo[p].show(),!!e},this.isDragging=function(){return u},this.onPointerDown=function(e){if(void 0===h.object||!0===u)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(a=D(n,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children))&&(o=-1!=(i=a.object.name).search("R")?"rotate":"translate"),h.axis!==i&&(h.axis=i,h.gizmo[p].activeMode=o)}var a=null;if((0===n.button||-1===n.button||void 0===n.button)&&(a=D(n,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children))){h.dispatchEvent(d),h.axis=a.object.name,h.update(),x.copy(t.position).sub(j).normalize(),t.isPerspective||t.getWorldDirection(x),h.gizmo[p].setActivePlane(h.axis,x,"local"===h.space);var s=D(n,[h.gizmo[p].activePlane]);if(s&&w.copy(s.point),I.copy(h.object.position),O.copy(h.object.scale),X.extractRotation(h.object.matrix),_.extractRotation(h.object.matrixWorld),h.object.parent?(G.extractRotation(h.object.parent.matrixWorld),Y.setFromMatrixScale(H.copy(h.object.parent.matrixWorld).invert())):(G.extractRotation(h.object.matrixWorld),Y.setFromMatrixScale(H.copy(h.object.matrixWorld).invert())),"transrotate"===p&&"rotate"===h.gizmo[p].activeMode){{const t=h.startLine.geometry.getAttribute("position");t.setXYZ(0,0,0,0),t.setXYZ(1,0,0,1),t.applyMatrix4(h.matrixWorld),t.needsUpdate=!0,h.parent.add(h.startLine)}var r=h.object.geometry.getAttribute("position"),c=(new THREE.Vector3).fromBufferAttribute(r,0).applyMatrix4(h.object.matrixWorld),l=(new THREE.Vector3).fromBufferAttribute(r,1).applyMatrix4(h.object.matrixWorld),E=(new THREE.Vector3).fromBufferAttribute(r,2).applyMatrix4(h.object.matrixWorld),m=(new THREE.Vector3).fromBufferAttribute(r,3).applyMatrix4(h.object.matrixWorld);const t=h.centerLine.geometry.getAttribute("position");if("RX"===h.axis){c.lerp(E,.5),l.lerp(m,.5);var f=c.distanceTo(l);h.centerLine.material.dashSize=f/15,h.centerLine.material.gapSize=f/30,t.setXYZ(0,c.x,c.y,c.z),t.setXYZ(1,l.x,l.y,l.z)}else c.lerp(l,.5),E.lerp(m,.5),f=c.distanceTo(E),h.centerLine.material.dashSize=f/15,h.centerLine.material.gapSize=f/30,t.setXYZ(0,c.x,c.y,c.z),t.setXYZ(1,E.x,E.y,E.z);h.centerLine.computeLineDistances(),t.needsUpdate=!0,h.parent.add(h.centerLine),h.ticks[h.axis].position.copy(h.position),h.ticks[h.axis].quaternion.copy(h.quaternion),h.ticks[h.axis].scale.copy(h.scale),h.parent.add(h.ticks[h.axis])}}return u=!0,!!a},this.onPointerMove=function(t){if(void 0===h.object||null===h.axis||!1===u)return!1;var e=D(t,[h.gizmo[p].activePlane]);e&&v.copy(e.point);var n=h.gizmo[p].activeMode;if("translate"==n)v.sub(w),v.multiply(Y),"local"==h.space&&(v.applyMatrix4(H.copy(_).invert()),-1==h.axis.search("X")&&(v.x=0),-1==h.axis.search("Y")&&(v.y=0),-1==h.axis.search("Z")&&(v.z=0),v.applyMatrix4(X),h.object.position.copy(I),h.object.position.add(v)),"world"!=h.space&&-1==h.axis.search("XYZ")||(P.copy(this.unitX),A.copy(this.unitY),S.copy(this.unitZ),b.set(0,0,0),-1!=h.axis.search("X")&&(P.multiplyScalar(v.dot(this.unitX)),b.add(P)),-1!=h.axis.search("Y")&&(A.multiplyScalar(v.dot(this.unitY)),b.add(A)),-1!=h.axis.search("Z")&&(S.multiplyScalar(v.dot(this.unitZ)),b.add(S)),v.copy(b),v.applyMatrix4(H.copy(G).invert()),h.object.position.copy(I),h.object.position.add(v));else if("scale"==n)v.sub(w),v.multiply(Y),"local"==h.space&&("XYZ"==h.axis?(g=1+v.y/50,h.object.scale.x=O.x*g,h.object.scale.y=O.y*g,h.object.scale.z=O.z*g):(v.applyMatrix4(H.copy(_).invert()),"X"==h.axis&&(h.object.scale.x=O.x*(1+v.x/50)),"Y"==h.axis&&(h.object.scale.y=O.y*(1+v.y/50)),"Z"==h.axis&&(h.object.scale.z=O.z*(1+v.z/50))));else if("rotate"==n){if(v.sub(j),v.multiply(Y),b.copy(w).sub(j),b.multiply(Y),"RE"==h.axis){H.copy(R).invert(),v.applyMatrix4(H),b.applyMatrix4(H),T.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),y.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),M.setFromRotationMatrix(H.copy(G).invert());var i=T.z-y.z;if(null!==h.snap){var o=Math.round(i/h.snap)*h.snap;Math.abs(o-i)<h.snapDelta&&(i=o)}z.setFromAxisAngle(x,i),C.setFromRotationMatrix(_),M.multiplyQuaternions(M,z),M.multiplyQuaternions(M,C),h.object.quaternion.copy(M)}else if("RXYZE"==h.axis){var a=v.clone().cross(b).normalize();M.setFromRotationMatrix(H.copy(G).invert());var s=-v.clone().angleTo(b);null!==h.snap&&(o=Math.round(s/h.snap)*h.snap,Math.abs(o-s)<h.snapDelta&&(s=o)),B.setFromAxisAngle(a,s),C.setFromRotationMatrix(_),M.multiplyQuaternions(M,B),M.multiplyQuaternions(M,C),h.object.quaternion.copy(M)}else if("local"==h.space){H.copy(_).invert(),v.applyMatrix4(H),b.applyMatrix4(H);var r=v.dot(this.unitX),c=v.dot(this.unitY),l=v.dot(this.unitZ),d=b.dot(this.unitX),m=b.dot(this.unitY),Z=b.dot(this.unitZ);T.set(Math.atan2(l,c),Math.atan2(r,l),Math.atan2(c,r)),y.set(Math.atan2(Z,m),Math.atan2(d,Z),Math.atan2(m,d));var L=T.x-y.x,N=T.y-y.y;i=T.z-y.z,null!==h.snap&&(-1!=h.axis.search("X")&&(o=Math.round(L/h.snap)*h.snap,Math.abs(o-L)<h.snapDelta&&(L=o)),-1!=h.axis.search("Y")&&(o=Math.round(N/h.snap)*h.snap,Math.abs(o-N)<h.snapDelta&&(N=o)),-1!=h.axis.search("Z")&&(o=Math.round(i/h.snap)*h.snap,Math.abs(o-i)<h.snapDelta&&(i=o))),B.setFromAxisAngle(this.unitX,L),V.setFromAxisAngle(this.unitY,N),k.setFromAxisAngle(this.unitZ,i),C.setFromRotationMatrix(X),"RX"==h.axis&&C.multiplyQuaternions(C,B),"RY"==h.axis&&C.multiplyQuaternions(C,V),"RZ"==h.axis&&C.multiplyQuaternions(C,k),h.object.quaternion.copy(C)}else"world"==h.space&&(r=v.dot(this.unitX),c=v.dot(this.unitY),l=v.dot(this.unitZ),d=b.dot(this.unitX),m=b.dot(this.unitY),Z=b.dot(this.unitZ),T.set(Math.atan2(l,c),Math.atan2(r,l),Math.atan2(c,r)),y.set(Math.atan2(Z,m),Math.atan2(d,Z),Math.atan2(m,d)),M.setFromRotationMatrix(H.copy(G).invert()),L=T.x-y.x,N=T.y-y.y,i=T.z-y.z,null!==h.snap&&(-1!=h.axis.search("X")&&(o=Math.round(L/h.snap)*h.snap,Math.abs(o-L)<h.snapDelta&&(L=o)),-1!=h.axis.search("Y")&&(o=Math.round(N/h.snap)*h.snap,Math.abs(o-N)<h.snapDelta&&(N=o)),-1!=h.axis.search("Z")&&(o=Math.round(i/h.snap)*h.snap,Math.abs(o-i)<h.snapDelta&&(i=o))),B.setFromAxisAngle(this.unitX,L),V.setFromAxisAngle(this.unitY,N),k.setFromAxisAngle(this.unitZ,i),C.setFromRotationMatrix(_),"RX"==h.axis&&M.multiplyQuaternions(M,B),"RY"==h.axis&&M.multiplyQuaternions(M,V),"RZ"==h.axis&&M.multiplyQuaternions(M,k),M.multiplyQuaternions(M,C),h.object.quaternion.copy(M));"transrotate"===p&&(h.add(h.endLine),h.add(h.centerMark))}return h.object.matrixAutoUpdate=!0,h.update(!0),h.dispatchEvent(E),h.dispatchEvent(f),!!e},this.onPointerUp=function(t){return u&&null!==h.axis&&(m.mode=p,h.dispatchEvent(m)),u=!1,this.gizmo[p].show(),this.updateUnitVectors(),"transrotate"===p&&"rotate"===this.gizmo[p].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}}static intersectObjects(t,e,n,i,o){var a=t/i.clientWidth*2-1,l=-e/i.clientHeight*2+1;i.isPerspective?(s.set(a,l,.5),s.unproject(i),c.set(i.position,s.sub(i.position).normalize())):(s.set(a,l,-1),s.unproject(i),r.set(0,0,-1),c.set(s,r.transformDirection(i.matrixWorld)));var h=c.intersectObjects(n,o);return h[0]?h[0]:null}}THREE.TransformControls=l}(),function(){if(o)return;const t=new THREE.Vector3;class e extends THREE.Mesh{constructor(t,e,n){super(t,e,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outline=null}update(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,n=-1*this.getWorldPosition(t).dot(e);this.planeVec.set(e.x,e.y,e.z,n),this.plane.constant=n}}o=e}();var Y=new a.FragmentIterator({delay:50});function j(t){if(!k)return;const e=Autodesk.Viewing.Extensions.CompGeom;l.sceneAfter.skipDepthTarget=!0,st();var n=new THREE.Object3D;n.name="section3D",l.scene.add(n);var i=new THREE.Object3D;i.name="section2D",l.sceneAfter.add(i);var o=e.makePlaneBasis(t),s=o.clone().invert(),r=l.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0,noIdOutput:!0},!1,!1),c=l.matman().findMaterial(null,r);c.transparent=!0,c.depthTest=!0,c.polygonOffset=!0,c.polygonOffsetFactor=-1,c.polygonOffsetUnits=.1,c.cutplanes=_;var h,u=new THREE.Box3,p=l.modelQueue().getModels().filter((t=>!t.getDoNotCut())),E=[];Y.start(p,(function(r,p,d,v){var w=d.getFragmentList();if(w.getWorldBounds(r,u),e.xBoxPlane(t,u)){var T=w.getVizmesh(r);T.geometry&&!T.geometry.is2d&&!T.geometry.isLines&&T.material.cutplanes&&(h=T.material,e.xMeshPlane(t,T,E))}if(v){if(E.length){var y=new THREE.Box3;e.convertToPlaneCoords(o,E,y);var g=new a.VertexBufferBuilder(!1,8*E.length),R=function(t){return t&&t.color||new THREE.Color(16777215)}(h),x=0|.25*R.r*255.5,H=0|.25*R.g*255.5,b=4278190080|(0|.25*R.b*255.5)<<16|H<<8|x,M=new e.EdgeSet(E,y,1e-6*y.getSize(new THREE.Vector3).length());M.snapEdges(),M.sanitizeEdges(),M.stitchContours();var P=M.triangulate({skipOpenContour:!0});if(P){for(let t=0;t<P.contours.length;t++)for(var A=P.contours[t],S=1;S<A.length;S++){var C=P.pts[A[S-1]],B=P.pts[A[S]];g.addSegment(C.x,C.y,B.x,B.y,0,-2,b,p,0)}var V={mesh:g.toMesh()};a.BufferGeometryUtils.meshToGeometry(V);var k=V.geometry;k.streamingDraw=!0,k.streamingIndex=!0;var z=new THREE.Mesh(k,c);if(z.matrix.copy(s),z.matrixAutoUpdate=!1,z.frustumCulled=!1,z.modelId=d.id,z.dbId=p,i.add(z),!P.triangulationFailed){var I=P.toPolygonMesh(h.packedNormals),O=l.matman().cloneMaterial(h,d);let t;null!=O.prismType&&(O.defines={},O.defines[O.prismType.toUpperCase()]="","PrismWood"==O.prismType&&(O.defines.NO_UVW="")),O.packedNormals=h.packedNormals,O.mrtIdBuffer=h.mrtIdBuffer,O.mrtNormals=h.mrtNormals,O.cutplanes=_,O.side=THREE.FrontSide,O.depthTest=!0,O.map=null,O.bumpMap=null,O.normalMap=null,O.alphaMap=null,O.specularMap=null,O.transparent=!1,O.depthWrite=!0,O.hatchPattern=!0,O.needsUpdate=!0,t=h.id+2;var X=t*Math.PI*.125,G=Math.tan(X);O.hatchParams=new THREE.Vector2(G,10),O.hatchTintColor=new THREE.Color(m.r,m.g,m.b),O.hatchTintIntensity=f;var Y=new THREE.Mesh(I,O);Y.matrix.copy(s),Y.matrixAutoUpdate=!1,Y.modelId=d.id,Y.dbId=p,Y.fragId=E.fragId,n.add(Y)}}}E.length=0}}),(()=>{l.invalidate(!0,!0)}))}var Z="Autodesk.Viewing.Extension.Section.SectionTool";l.setCutPlaneSetFor2DRendering(Z);var _=[];function L(t){function e(e){e&&e.traverse((function(e){e instanceof THREE.Mesh&&e.material&&(t?l.matman().adjustMaterialMRTSetting(e.material):e.material.needsUpdate=!0)}))}e(l.scene.getObjectByName("section3D")),e(l.sceneAfter.getObjectByName("section2D"))}function D(t,e){var n,i,a=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(e){const o=t.projectPoint(e.max,new THREE.Vector3),s=t.projectPoint(e.min,new THREE.Vector3),r=a.clone().invert();o.applyQuaternion(r),s.applyQuaternion(r),i=(new THREE.Vector3).subVectors(o,s),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(e=l.getVisibleBounds()).getBoundingSphere(new THREE.Sphere).radius,n=new THREE.PlaneBufferGeometry(i,i);var s=new THREE.MeshBasicMaterial({opacity:0,color:2653930,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),r=new o(n,s,t);const c=t.projectPoint(e.getCenter(new THREE.Vector3),new THREE.Vector3);r.position.copy(c),r.quaternion.multiply(a);var h=l.currentLightPreset();h=Math.max(0,h);var u=Autodesk.Viewing.Private.LightPresets[h].bgColorGradient,p="rgb("+(255-u[0])+","+(255-u[1])+","+(255-u[2])+")",E=new THREE.LineBasicMaterial({color:p,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0}),d=r.geometry.getAttribute("position");const m=[];for(var f=0;f<V.length;f++)m.push((new THREE.Vector3).fromBufferAttribute(d,V[f]));const v=new THREE.Line((new THREE.BufferGeometry).setFromPoints(m),E);return r.add(v),r.outline=v,r}function N(t){F((function(e){if(e instanceof o){let o;if(e.connectivity.length>0){var n=e.matrixWorld.clone().invert();const t=new THREE.Vector3;o=e.geometry.getAttribute("position");for(let a=0;a<o.count;a++){var i=e.connectivity[a];null!==ot(e.plane,i[0],i[1],t)&&(t.applyMatrix4(n),o.setXYZ(a,t.x,t.y,t.z))}o.needsUpdate=!0,e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()}else if(t){var a=l.getVisibleBounds(),s=2*a.getBoundingSphere(new THREE.Sphere).radius;const t=e.plane.projectPoint(a.getCenter(new THREE.Vector3),new THREE.Vector3);e.geometry=new THREE.PlaneBufferGeometry(s,s),e.position.copy(t),o=e.geometry.getAttribute("position")}if(o){for(let t=0;t<V.length;t++)e.outline.geometry.attributes.position.setXYZ(t,o.getX(V[t]),o.getY(V[t]),o.getZ(V[t]));e.outline.geometry.attributes.position.needsUpdate=!0}}}))}function F(t){for(var e=0;e<H.length;e++)H[e].traverse(t)}function W(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];F((function(t){t instanceof o&&t.update()})),1===b.length&&j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(Z,b,t)}function U(t){for(var e=0;e<H.length;e++)H[e].visible=t;d!==t&&I(),d=t}function Q(t){t&&b.length>0&&(1===b.length&&j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(Z,b)),U(t)}function q(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function J(t){return l.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function K(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var i=l.getVisibleBounds(),o=i.getCenter(new THREE.Vector3),a=new THREE.Group;e=void 0!==e?e:-1*o.dot(t);var r=new THREE.Plane(t,e),c=D(r,null);a.add(c),b.push(c.planeVec),H.push(a),l.addOverlay(A,a),s&&(q(s,c),c.material.opacity=0,$(c),s.showRotationGizmos(!0),M=s.getPicker()),W(n),u&&O()}function $(t){if(!s||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(c),s.setGizmoOffset(e),!0}var tt,et,nt,it,ot=(tt=new THREE.Matrix3,et=new THREE.Vector3,nt=new THREE.Vector3,it=new THREE.Vector3,function(t,e,n,i){tt.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=tt.determinant();return 0===o?null:(et.crossVectors(e.normal,n.normal).multiplyScalar(-t.constant),nt.crossVectors(n.normal,t.normal).multiplyScalar(-e.constant),it.crossVectors(t.normal,e.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy(et).add(nt).add(it).divideScalar(o))}),at=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,l.camera,n)};function st(){var t=l.scene.getObjectByName("section3D");t&&l.scene.remove(t);var e=l.sceneAfter.getObjectByName("section2D");e&&l.sceneAfter.remove(e)}this.isActive=function(){return u},this.getSectionDistance=function(t){var e=l.api.navigation.getEyeVector(),n=l.rayIntersect(new THREE.Ray(l.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e;this.clearSection(t);var n=l.getCutPlaneSet("__set_view");if(1===n.length){s.clientScale=1;var i=n[0];e=new THREE.Vector3(i.x,i.y,i.z);var o=i.w;K(e,o,t),P="SET_VIEW_PLANE",l.setCutPlaneSet("__set_view",void 0,t)}},this.setSection=function(e){var n,i;this.clearSection(),c=new THREE.Vector3,s.clientScale=1;var o=l.getCutPlaneSet("__set_view");switch(1===o.length&&"BOX"!==e&&"OBJ_SET_VIEW_PLANE"!==e&&(e="SET_VIEW_PLANE"),e){case"X":n=new THREE.Vector3(1,0,0),i=this.getSectionDistance(n),K(J(n),i);break;case"Y":n=new THREE.Vector3(0,1,0),i=this.getSectionDistance(n),K(J(n),i);break;case"Z":n=new THREE.Vector3(0,0,1),i=this.getSectionDistance(n),K(J(n),i);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var a=o[0];K(n=new THREE.Vector3(a.x,a.y,a.z),a.w);break;case"OBJ_BOX":case"BOX":!function(e){var n=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],i=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,a=l.getVisibleBounds(),c=a.getCenter(new THREE.Vector3),h=new THREE.Box3(a.min,c),u=!1;e&&6===e.length&&1===e[0].x&&(c=(h=new THREE.Box3(new THREE.Vector3(e[3].w,e[4].w,e[5].w),new THREE.Vector3(e[0].w,e[1].w,e[2].w))).max.clone(),u=!0);const[p,E]=[new THREE.Vector3,new THREE.Vector3];var d,m,f,v=[],w=[];for(d=0;d<n.length;d++){if(u)f=new THREE.Plane(n[d],e[d].w),v.push(f);else if(f=new THREE.Plane(n[d],-1*c.dot(n[d])),v.push(f),d>2){t(f,h.max,p),t(f,h.min,E);var T=(new THREE.Vector3).subVectors(p,E);f.constant-=T.length()}m=D(f,h),o.add(m),w.push(m),b.push(m.planeVec)}for(d=0;d<w.length;d++){m=w[d];for(var y=i[d],g=0;g<y.length;g++){for(var R=[],x=y[g],P=0;P<x.length;P++)R.push(v[x[P]]);m.connectivity.push(R)}}H.push(o),l.addOverlay(A,o),W(),N(),f=H[0].children[0],q(s,f),f.material.opacity=.25,$(f),q(r,H[0]),s.showRotationGizmos(!1),M=s.getPicker().concat(r.getPicker());var S=H[0].position.clone().sub(c.clone());r.setGizmoOffset(S)}(o),s.clientScale=2,this.recomputePivot()}P=e,l.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),K(new THREE.Vector3(t.x,t.y,t.z),t.w),P="",l.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){P=t||""},this.setDisplaySectionHatches=function(t){k=t},this.updateCapMeshes=function(t){t&&(K(t.normal,t.constant),j(t))},this.clearSection=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(s&&s.detach(),r&&r.detach();b.length>0;)b.pop();for(;H.length>0;){var e=H.pop();l.removeOverlay(A,e)}Y.start(null),st(),l.setCutPlaneSet(Z,null,t)},this.isPlaneOn=function(){return d},this.showPlane=function(t){U(t)},this.attachControl=function(t){s&&r&&(t?(q(s,H[0].children[0]),s.highlight(),"BOX"===P&&q(r,H[0])):(s.detach(),r.detach()))},this.resetSection=function(){this.setSection(P)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.register=function(){},this.deregister=function(){this.clearSection(),C&&(l.removeOverlay(A,s),s.removeEventListener("change",I),s=null,l.removeOverlay(A,r),r.removeEventListener("change",I),r.removeEventListener("change",X),r=null,l.removeOverlayScene(A),n.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),n.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,G),n.removeEventListener(Autodesk.Viewing.HIDE_EVENT,G),n.removeEventListener(Autodesk.Viewing.SHOW_EVENT,G),n.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,G),C=!1)},this.getPriority=function(){return 70},this.activate=function(){!function(){if(C)return l.addOverlay(A,s),void l.addOverlay(A,r);(s=new THREE.TransformControls(l.camera,l.canvas,"transrotate")).addEventListener("change",I),s.setSnap(Math.PI/2,Math.PI/36),(r=new THREE.TransformControls(l.camera,l.canvas,"translate")).addEventListener("change",I),r.addEventListener("change",X),void 0===l.overlayScenes.gizmo&&l.createOverlayScene(A),l.addOverlay(A,s),l.addOverlay(A,r),n.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),n.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,G),n.addEventListener(Autodesk.Viewing.HIDE_EVENT,G),n.addEventListener(Autodesk.Viewing.SHOW_EVENT,G),n.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,G),C=!0}(),u=!0,p=!1,B=!0,b=b||[],Q(!0)},this.deactivate=function(){if(u=!1,p=!1,this.keepCutPlanesOnDeactivate){l.removeOverlay(A,s),l.removeOverlay(A,r);for(let t=0;t<H.length;t++)l.removeOverlay(A,H[t])}else Y.start(null),st(),Q(!1),l.setCutPlaneSet(Z);s.detach(),r.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e,n=at(t,null===(e=H[0])||void 0===e?void 0:e.children);if(H[0].children.forEach((function(t){t.material.opacity=0})),n){var i;const t=s.object;q(s,n.object),s.highlight(),n.object.material.opacity=b.length>1?.25:0,(null===(i=H[0])||void 0===i?void 0:i.children.length)>1&&t!==n.object&&$(n.object),I(),X()}return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return p=!0,!!r.onPointerDown(t)||s.onPointerDown(t)},this.handleButtonUp=function(t){return p=!1,E&&(E=!1,this.recomputePivot()),!!r.onPointerUp(t)||s.onPointerUp(t)},this.handleMouseMove=function(t){var e=r.object?(new THREE.Vector3).copy(r.object.position):null;if(p){if(r.onPointerMove(t)){E=!0,W(),s.update();var n=(new THREE.Vector3).copy(r.object.position).sub(e);return c.add(n),z("Canvas","Box","translate"),!0}if(s.onPointerMove(t)){if(E=!0,W(),N(),P.includes("BOX"))z("Canvas","Box","transform");else{const t=-1!=s.axis.search("R")?"rotate":"translate";z("Canvas","Plane",t)}return!0}}if(r.visible=void 0!==r.object,"touch"!==t.pointerType){var i,o=t,a=at(o,null===(i=H[0])||void 0===i?void 0:i.children);a&&(B=!1);var l=!!(B||a||at(o,M,!0));s.visible=l,r.visible=r.visible&&l,U(l)}return!!r.onPointerHover(t)||s.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return S="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===S&&this.handleMouseMove(t);case"dragend":return"drag"===S&&(S=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!1},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;l.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,a=n[2].position.z,s=n[3].position.x,r=n[4].position.y,c=n[5].position.z,h={x:0,y:0,z:0};return t||(h=l.model.getData().globalOffset||h),{sectionBox:[Math.min(s,i)+h.x,Math.min(o,r)+h.y,Math.min(a,c)+h.z,Math.max(s,i)+h.x,Math.max(o,r)+h.y,Math.max(a,c)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=l.model.getData().globalOffset||i);var o=n[0].plane,a=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,a]}},this.getSectionPlaneSet=function(){return l.getCutPlaneSet(Z)},this.getSectionPlanes=function(){const t=l.getCutPlaneSet("__set_view");return t.length>0?t:l.getCutPlaneSet(Z)},this.notifyCutplanesChanged=function(){var t=_.length;_.length=0;for(var e=l.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==Z)for(var o=l.getCutPlaneSet(i),a=0;a<o.length;a++)_.push(o[a])}e.includes("__set_view")&&""!==P&&-1===P.indexOf("OBJ_")&&this.setViewerSection(!1),t!==_.length&&L(!1)},this.notifyRenderOptionChanged=function(){L(!0)},this.setSectionBox=function(t){if(!t)return!1;const e="OBJ_BOX",n=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return P=e,l.setCutPlaneSet("__set_view",n),this.setSection(e),!0},this.setSectionPlane=function(t,e){var n,i;let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!e)return!1;const a="OBJ_SET_VIEW_PLANE",r=-1*e.dot(t),c=new THREE.Plane(t,r);P=a;const h=[new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant)];l.setCutPlaneSet("__set_view",h),this.setSection(a),null===(n=s)||void 0===n||n.showRotationGizmos(o);const u=e.clone().sub(H[0].children[0].position);return null===(i=s)||void 0===i||i.setGizmoOffset(u),!0}};var r=n(93379),c=n.n(r),l=n(7795),h=n.n(l),u=n(90569),p=n.n(u),E=n(3565),d=n.n(E),m=n(19216),f=n.n(m),v=n(44589),w=n.n(v),T=n(83427),y={};y.styleTagTransform=w(),y.setAttributes=d(),y.insert=p().bind(null,"head"),y.domAPI=h(),y.insertStyleElement=f();c()(T.Z,y);T.Z&&T.Z.locals&&T.Z.locals;const g=Autodesk.Viewing.Private,R=Autodesk.Viewing.UI,x=g.analytics;var H=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.buttons={},this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};H.prototype=Object.create(Autodesk.Viewing.Extension.prototype),H.prototype.constructor=H;var b=H.prototype;b.load=function(){var t=this,e=this.viewer;this.tool=new s(e,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),e.toolController.registerTool(this.tool,this.setActive.bind(this)),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],this.displaySectionHatches=this.displaySectionHatches.bind(this),this.viewer.prefs.addListeners(g.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),e.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),e.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),e.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),e.addEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,t.tool.notifyRenderOptionChanged),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var n=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){if(0===t.viewer.getAggregateSelection().length)return t.deactivate()}}];return e.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,n),this.viewer.registerContextMenuCallback("Autodesk.Section",((t,e)=>{!function(t,e,n){var i;if(!n.hasSelected)return;const o=t.viewer,a=o.getAggregateSelection();if(1===a.length&&a[0].model.is2d())return;const s=o.impl.selector.getSelectionBounds(),r={title:"Section",target:[]};r.target.push({title:"Section Box",target:()=>{t.setSectionBox(s),x.track("viewer.section",{from:"Contextual",type:"Box",action:"Enable"})}});const c=a.map((t=>t.selection)).flat(),l=a.map((t=>t.model.id)),h=o.impl.hitTest(n.canvasX,n.canvasY,!1,c,l);if(null!=h&&null!==(i=h.face)&&void 0!==i&&i.normal&&h.model&&-1!==c.indexOf(h.dbId)){const e=o.impl.getRenderProxy(h.model,h.fragId),n=(new THREE.Matrix3).getNormalMatrix(e.matrixWorld),i=h.face.normal.clone().applyMatrix3(n).normalize();r.target.push({title:"Section Plane",target:()=>{t.setSectionPlane(i,h.point,!1),x.track("viewer.section",{from:"Contextual",type:"Plane",action:"Enable"})}})}e.push(r)}(this,t,e)})),this.viewer.loadExtension("Autodesk.CompGeom")},b.unload=function(){var t=this.viewer;return t.unregisterContextMenuCallback("Autodesk.Section"),t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),t.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),t.removeEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,this.tool.notifyRenderOptionChanged),this.viewer.prefs.removeListeners(g.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),t.toolController.deregisterTool(this.tool),this.tool=null,!0},b.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},b.getSectionStyle=function(){return this.sectionStyle},b.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},b.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},b.getSectionPlanes=function(){return this.tool.getSectionPlanes()},b.enableSectionTool=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=this.viewer.toolController,i=this.tool.isActive();if(t&&!i)return n.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!t&&i){const t=this.tool.keepCutPlanesOnDeactivate;return this.tool.keepCutPlanesOnDeactivate=e,n.deactivateTool("section"),this.tool.keepCutPlanesOnDeactivate=t,this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return t&&n.activateToolModality("section"),!1},b.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);if(e)return e;var n=this.tool.getSectionPlaneValues(t);return n||null},b.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},b.restoreState=function(t){if(!t.cutplanes)return;const e=this.getSectionPlanes();return this.setSectionFromPlane(null),1===e.length&&this.setSectionFromPlane(e[0]),!0},b._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},b._onShowAll=function(){this.deactivate()},b.setSectionBox=function(t){var e;t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode="box",null===(e=this.buttons[this.mode])||void 0===e||e.setState(R.Button.State.ACTIVE)):this.enableSectionTool(!1))},b.setSectionPlane=function(t,e,n){var i;t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e,n)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode=this.calculateNearestAxis(t),null===(i=this.buttons[this.mode])||void 0===i||i.setState(R.Button.State.ACTIVE)):this.enableSectionTool(!1))},b.calculateNearestAxis=function(t){const e=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z);return e>=n&&e>=i?"x":n>e&&n>=i?"y":"z"},b.onViewerSetView=function(){this.deactivate()},b.onToolbarCreated=function(t){this.sectionToolButton=new R.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var e=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(e){var n=e.getControl("toolbar-resetTool");n?e.addControl(this.sectionToolButton,{index:e.indexOf(n.getId())}):e.addControl(this.sectionToolButton,{index:0})}},b.createSubmenu=function(t){var e=this,n=this.viewer;function i(t,n){return e.buttons[n]=t,function(){var i=t.getState(),o=function(){t instanceof R.ComboButton==!1?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))};const a=-1!==n.toLowerCase().indexOf("box")?"Box":"Plane";i===R.Button.State.INACTIVE?(t.setState(R.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o(),x.track("viewer.section",{from:"Toolbar",type:a,action:"Enable"})):i===R.Button.State.ACTIVE&&(t.setState(R.Button.State.INACTIVE),e.deactivate(),x.track("viewer.section",{from:"Toolbar",type:a,action:"Disable"})),e.sectionStyle=n.toUpperCase()}}function o(){var t,i=(t=new THREE.Vector3,function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}),o=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),r=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector(),h=1e-4;i(c,o,h)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,s,h)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(r,a,h)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(r,s,h)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,h)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,a,h)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z")}var a=this.sectionXButton=new R.Button("toolbar-sectionTool-x");a.setToolTip("Add X plane"),a.setIcon("adsk-icon-plane-x"),a.onClick=i(a,"x"),t.addControl(a);var s=this.sectionYButton=new R.Button("toolbar-sectionTool-y");s.setToolTip("Add Y plane"),s.setIcon("adsk-icon-plane-y"),s.onClick=i(s,"y"),t.addControl(s);var r=this.sectionZButton=new R.Button("toolbar-sectionTool-z");r.setToolTip("Add Z plane"),r.setIcon("adsk-icon-plane-z"),r.onClick=i(r,"z"),t.addControl(r);var c=this.sectionBoxButton=new R.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=i(c,"box"),t.addControl(c),n.model?o():n.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,o,{once:!0})},b.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null,this.buttons={})},b.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},b.deactivate=function(t){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1,t),this.activeStatus=!1,!0)},b.displaySectionHatches=function(t){if(this.tool.setDisplaySectionHatches(t),this.activeStatus){const t=this.getSectionPlanes();this.tool.clearSection(),t.forEach((t=>{this.tool.updateCapMeshes((new THREE.Plane).setComponents(t.x,t.y,t.z,t.w))}))}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",H)})(),Autodesk.Extensions.Section=i})();
//# sourceMappingURL=Section.min.js.map